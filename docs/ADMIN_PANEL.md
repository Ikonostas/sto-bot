# Документация по админ-панели

Админ-панель предоставляет расширенный функционал для пользователей с ролью Администратор. Она включает в себя два основных раздела: "Согласование" и "Список агентов".

## Доступ к админ-панели

Пользователи с ролью Администратор могут получить доступ к админ-панели через главное меню бота, нажав на кнопку "Админ панель".

## Раздел "Согласование"

В этом разделе отображаются все активные карточки ТО, ожидающие согласования от администраторов. Администраторы могут просматривать детали каждой карточки и принимать решение о её согласовании или отклонении.

### Просмотр карточек, ожидающих согласования

Карточки отображаются списком с основной информацией:
- Номер карточки ТО
- Дата создания
- Имя агента
- Категория автомобиля
- Название СТО
- Время записи
- Данные клиента
- Стоимость
- Информация о дефектах (если есть)

### Согласование карточки ТО

При нажатии на кнопку "Согласовать":
1. Карточка ТО получает статус "Согласовано"
2. Агенту отправляется уведомление о согласовании
3. Сумма карточки учитывается в балансе агента

### Отклонение карточки ТО

При нажатии на кнопку "Отклонить":
1. Администратору предлагается указать причину отклонения
2. После ввода причины карточка получает статус "Отклонено"
3. Агенту отправляется уведомление с причиной отклонения

## Раздел "Список агентов"

В этом разделе отображается список всех агентов, зарегистрированных в системе. При выборе конкретного агента администратору доступны три действия: Info, Archive и Action.

### Info (Информация об агенте)

При выборе этого действия отображается полная информация об агенте:
- ФИО
- Компания
- Телефон
- Ссылка на мессенджер (если добавлена)
- Статистика ТО:
  - Количество согласованных карточек
  - Количество отклоненных карточек
- Финансовая информация:
  - Текущий баланс
  - Процент комиссии
  - Сумма комиссионных
  - Сумма выплат

### Archive (Архив агента)

При выборе этого действия отображается:
- Список всех карточек ТО агента (с пагинацией)
- Подробная информация о каждой карточке
- Статус каждой карточки (согласовано/отклонено/ожидает)
- Причина отклонения (если карточка отклонена)
- История платежей агента с комментариями

### Action (Действия с агентом)

При выборе этого действия администратору доступны три операции:

#### 1. Добавить карточку расчета

Эта опция позволяет добавить запись о платеже от агента или к агенту:
1. Администратор вводит сумму платежа (положительную для поступления, отрицательную для выплаты)
2. Вводит комментарий к платежу
3. Система создает запись о платеже и обновляет баланс агента

#### 2. Изменить карточку ТО

Опция для редактирования существующих карточек ТО:
1. Администратор выбирает карточку из списка
2. Выбирает поле для редактирования
3. Вводит новое значение
4. Система обновляет карточку

Доступные для редактирования поля:
- Дата и время записи
- Категория автомобиля
- Название СТО
- Стоимость
- Данные клиента
- Данные автомобиля
- Информация о дефектах
- Статус карточки
- Комментарий администратора

#### 3. Изменить комиссию агента

Эта опция позволяет изменить процент комиссии конкретного агента:
1. Администратор видит текущую ставку комиссии
2. Вводит новое значение (целое или десятичное через запятую)
3. Система обновляет ставку комиссии и пересчитывает баланс агента

## Расчет баланса агента

Баланс агента рассчитывается по формуле:
```
Баланс = Сумма всех согласованных карточек ТО - Комиссия агента - Сумма платежей
```

Где:
- Сумма всех согласованных карточек ТО — суммарная стоимость всех карточек ТО со статусом "Согласовано"
- Комиссия агента — процент комиссии, умноженный на сумму всех согласованных карточек ТО
- Сумма платежей — сумма всех платежей, где положительные значения уменьшают баланс, а отрицательные увеличивают

## Примечания

1. Все операции с агентами и карточками ТО логируются в системе
2. Изменение комиссии агента приводит к пересчету его баланса
3. При согласовании или отклонении карточки ТО агент получает соответствующее уведомление 