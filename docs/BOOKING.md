# Процесс бронирования времени на СТО

## Общая информация

Бот поддерживает бронирование времени на станциях технического обслуживания (СТО) для получения диагностической карты для автомобилей трех категорий (B, C, E). Процесс бронирования включает выбор категории автомобиля, станции СТО, указание информации о дефектах, выбор времени и заполнение информации о клиенте и автомобиле.

## Алгоритм бронирования

### 1. Выбор категории автомобиля

Пользователь выбирает одну из трех категорий автомобилей:
- Категория B (легковые автомобили)
- Категория C (грузовые автомобили)
- Категория E (прицепы)

### 2. Выбор станции СТО

После выбора категории пользователю предлагается список доступных станций СТО, которые обслуживают выбранную категорию автомобилей. Для каждой станции отображается:
- Название и адрес станции
- Стоимость прохождения ТО для выбранной категории

### 3. Проверка наличия дефектов

Пользователь указывает наличие дефектов на автомобиле:
- Дефектов нет: стоимость не меняется
- Незначительные дефекты: +1000 руб. к стоимости
- Значительные дефекты: +2000 руб. к стоимости

В случае наличия дефектов пользователь должен описать их.

### 4. Выбор времени

Пользователь выбирает дату и время для прохождения ТО:
1. Сначала выбирается дата (доступны текущая дата и 7 дней вперед)
2. Затем выбирается конкретное время из доступных слотов

Система автоматически исключает уже занятые временные слоты.

### 5. Информация о клиенте и автомобиле

Пользователь последовательно вводит:
- Имя клиента
- Номер автомобиля
- VIN номер автомобиля
- Номер телефона клиента (для отправки диагностической карты)

### 6. Подтверждение бронирования

Система формирует карточку ТО с уникальным номером и следующей информацией:
- Категория автомобиля
- Выбранная станция СТО
- Дата и время прохождения ТО
- Информация о клиенте и автомобиле
- Стоимость услуги с учетом дефектов
- Информация о дефектах (если есть)

Номер карточки ТО формируется по формуле: датаDDMMYYYY + ID агента*10 + порядковый номер записи агента за сегодня.

## Просмотр активных записей и баланса

Функция "Мои записи" предоставляет пользователю следующие возможности:

### Просмотр баланса

В начале страницы отображается:
- Текущий баланс агента
- Расшифровка баланса: сумма одобренных карточек ТО, комиссия агента, сумма платежей/выплат

Баланс рассчитывается по формуле:
```
Баланс = Сумма всех одобренных карточек ТО - Комиссия агента - Сумма выплат
```

### Список активных записей

Отображаются все активные (ожидающие согласования) карточки ТО агента:
- Общее количество активных записей
- Общая сумма всех активных записей
- Краткая информация по каждой карточке:
  - Номер карточки ТО
  - Дата и время записи
  - Категория автомобиля
  - Выбранное СТО
  - Стоимость

### Детальная информация о записи

При нажатии на кнопку "Подробнее" для конкретной карточки отображается:
- Полная информация о карточке ТО
- Данные о клиенте и автомобиле
- Информация о дефектах (если есть)
- Текущий статус карточки

### Отмена записи

Для активных карточек (ожидающих согласования) пользователь может:
1. Нажать кнопку "Отменить запись"
2. Подтвердить отмену
3. После отмены карточка получает статус "Отменено" и перемещается в архив

## Архив записей

Функция "Архив" позволяет пользователю просмотреть:
- История завершенных (согласованных, отклоненных, отмененных) карточек ТО
- История платежей и расчетов

## Согласование записей администратором

Администраторы имеют доступ к специальному разделу "Согласование", где они могут:
1. Просматривать ожидающие согласования карточки ТО от всех агентов
2. Согласовывать карточки ТО
3. Отклонять карточки ТО с указанием причины

После согласования или отклонения карточки ТО агент получает соответствующее уведомление, а запись перемещается в архив. 