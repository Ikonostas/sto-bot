# Telegram Bot для записи на техническое обслуживание

Бот для управления записями на техническое обслуживание автомобилей на станциях ТО.

## Основные функции

- Запись на техническое обслуживание
- Просмотр своих записей
- Управление записями (для менеджеров)
- Защита от дублирования записей
- Учет количества слотов для каждой станции

## Последние обновления

### Версия 1.1.0 (11.03.2024)
- Добавлена защита от двойных записей на одно время
- Улучшена проверка доступности временных слотов
- Добавлена кнопка "Назад" при выборе времени
- Добавлена проверка на прошедшее время
- Исправлен баг с отображением занятых слотов
- Добавлена обработка ошибок при сохранении записи

## Установка и запуск

1. Клонируйте репозиторий:
```bash
git clone [URL репозитория]
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Создайте файл `.env` и добавьте токен бота:
```
BOT_TOKEN=ваш_токен_бота
```

4. Запустите бот:
```bash
python bot.py
```

## Технические детали

- Python 3.8+
- python-telegram-bot 20.7
- SQLAlchemy 2.0.23
- SQLite база данных

## Структура временных слотов

- Рабочие часы: 9:00 - 18:00
- Интервал записи: 30 минут
- Количество слотов в час настраивается для каждой станции
- Автоматическая блокировка прошедшего времени
- Защита от дублирования записей на одно время

## Возможности

- Запись клиентов на техосмотр
- Просмотр существующих записей
- Управление записями для менеджеров
- Поддержка 10 разных станций ТО
- Гибкое расписание с интервалами в 30 минут

## Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/your-username/sto-bot.git
cd sto-bot
```

2. Создайте виртуальное окружение и активируйте его:
```bash
python -m venv venv
source venv/bin/activate  # для Linux/Mac
venv\Scripts\activate     # для Windows
```

3. Установите зависимости:
```bash
python -m pip install -r requirements.txt
```

4. Создайте файл `.env` на основе `.env.example`:
```bash
cp .env.example .env  # для Linux/Mac
copy .env.example .env  # для Windows
```

5. Отредактируйте файл `.env` и добавьте ваш токен бота:
```
BOT_TOKEN=your_bot_token_here
```

6. Инициализируйте базу данных и добавьте станции ТО:
```bash
python init_stations.py
```

## Запуск

```bash
python bot.py
```

## Использование

1. Найдите бота в Telegram по его имени
2. Отправьте команду `/start`
3. Следуйте инструкциям бота для создания записи или просмотра существующих

## Для менеджеров

Чтобы получить права менеджера, необходимо установить флаг `is_manager=True` для соответствующего пользователя в базе данных.

## Безопасность

- Файл `.env` содержит конфиденциальные данные и не должен публиковаться в репозитории
- Используйте `.env.example` как шаблон для создания `.env`
- База данных `techservice.db` также исключена из репозитория

## Структура проекта

- `bot.py` - основной файл бота
- `models.py` - модели базы данных
- `init_stations.py` - скрипт инициализации станций
- `requirements.txt` - зависимости проекта
- `.env.example` - пример файла конфигурации
- `.gitignore` - список игнорируемых файлов 